var cb=function(e){"use strict";e(window).keydown((function(a){27===a.which&&e("#error_handler_overlay").length&&e("#error_handler_overlay").remove()})),e(document).off("click","#error_handler_overlay_close"),e(document).on("click","#error_handler_overlay_close",(function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,e("#error_handler_overlay").remove()}));var a=app_config.valid_class,r=app_config.error_class,i=app_config.loading_class,n={prospect:"prospect",checkout:"checkout",downsell1:"downsell",downsell2:"downsell",upsell:"upsell"},o={firstName:{},lastName:{},email:{validators:[["isValidEmail"]]},phone:{validators:[["isValidPhone"]]},shippingAddress1:{},shippingAddress2:{},shippingZip:{validators:[["isValidZip","shippingCountry"]]},shippingCity:{},shippingState:{},shippingCountry:{}},s={billingSameAsShipping:{},billingFirstName:{condition:["billingSameAsShipping","no"]},billingLastName:{condition:["billingSameAsShipping","no"]},billingAddress1:{condition:["billingSameAsShipping","no"]},billingAddress2:{condition:["billingSameAsShipping","no"]},billingZip:{condition:["billingSameAsShipping","no"],validators:[["isValidZip","billingCountry"]]},billingCity:{condition:["billingSameAsShipping","no"]},billingState:{condition:["billingSameAsShipping","no"]},billingCountry:{condition:["billingSameAsShipping","no"]},cardType:{aliases:["creditCardType"]},cardNumber:{aliases:["creditCardNumber"],validators:[["isValidCardNumber","cardType"]]},cardExpiryMonth:{aliases:["expmonth"]},cardExpiryYear:{aliases:["expyear"]},cvv:{aliases:["CVV"],validators:[["isValidCvv"]]}},t={data:{},fields:o,errors:{}},d={data:{},fields:s,errors:{}},l={data:{},fields:e.extend(!0,o,s),errors:{}};function c(i,n,o,s){o.data[i].value;switch(n.shift()){case"isValidEmail":!function(e,i,n){n.data[e].value;var o=n.data[e].name,s=i.val().trim();n.errors[o]=i.data("error-message"),i.removeClass(a).addClass(r),void 0===n.errors[o]&&(n.errors[o]="Enter a valid "+o.toUpperCase());if(!validator.isValidEmail(s))return;delete n.errors[o],i.removeClass(r).addClass(a)}(i,s,o);break;case"isValidPhone":!function(e,i,n){n.data[e].value;var o=n.data[e].name,s=i.val().trim();n.errors[o]=i.data("error-message"),i.removeClass(a).addClass(r),void 0===n.errors[o]&&(n.errors[o]="Enter a valid "+o.toUpperCase());if(!validator.isValidPhone(s))return;delete n.errors[o],i.removeClass(r).addClass(a)}(i,s,o);break;case"isValidZip":!function(e,i,n,o){n.data[e].value;var s=n.data[e].name,t=i.val().trim();n.errors[s]=i.data("error-message"),i.removeClass(a).addClass(r),void 0===n.errors[s]&&(n.errors[s]="Enter a valid "+s.toUpperCase());var d=n.data[o[0]].value;if(!validator.isValidZip(t,d))return;delete n.errors[s],i.removeClass(r).addClass(a)}(i,s,o,n);break;case"isValidCardNumber":!function(i,n,o,s){o.data[i].value;var t=o.data[i].name,d=n.val().trim().replace(/[\s-]/g,"");o.errors[t]=n.data("error-message"),n.removeClass(a).addClass(r),void 0===o.errors[t]&&(o.errors[t]="Enter a valid "+t.toUpperCase());var l=o.data[s[0]].value,c=!1;if(void 0!==app_config.allowed_tc&&app_config.allowed_tc.length){var p=cb.decryptAllowedTestCard(app_config.allowed_tc);e(p).each((function(e,a){var r=a.toString().split("|")[0];if(d===r)return c=!0,!0}))}if(!1===c&&!validator.isValidCardNumber(d,l))return;delete o.errors[t],n.removeClass(r).addClass(a)}(i,s,o,n);break;case"isValidCvv":!function(e,i,n,o){n.data[e].value;var s=n.data[e].name,t=i.val();n.errors[s]=i.data("error-message"),i.removeClass(a).addClass(r),void 0===n.errors[s]&&(n.errors[s]="Enter a valid "+s.toUpperCase());if(!validator.isValidCvv(t))return;delete n.errors[s],i.removeClass(r).addClass(a)}(i,s,o)}}function p(e,i,n){i.data[e].value;var o=i.data[e].name,s=n.val().trim();if(i.errors[o]=n.data("error-message"),n.removeClass(a).addClass(r),void 0===i.errors[o]&&(i.errors[o]="Enter a valid "+o.toUpperCase()),""!==s){var t=1,d=100;void 0!==n.data("min-length")&&(t=parseInt(n.data("min-length"))),void 0!==n.data("max-length")&&(d=parseInt(n.data("max-length"))),s.length<t||s.length>d||(delete i.errors[o],n.removeClass(r).addClass(a))}}function m(e,a,r){if(a.data[e]={value:"",name:e},r.find("[name="+e+"]").length)return"radio"!==r.find('[name="'+e+'"]').attr("type")?void(a.data[e]={value:r.find('[name="'+e+'"]').val(),name:e}):void(a.data[e]={value:r.find('[name="'+e+'"]:checked').val(),name:e});if(a.fields[e].hasOwnProperty("aliases"))for(var i in a.fields[e].aliases){var n=a.fields[e].aliases[i];if(r.find('[name="'+n+'"]').length){if("radio"!==r.find('[name="'+n+'"]').attr("type")){a.data[e]={value:r.find('[name="'+n+'"]').val(),name:n};break}a.data[e]={value:r.find('[name="'+n+'"]:checked').val(),name:n};break}}else a.data[e]={value:"",name:e}}function v(a){void 0!==a.submissionPixels&&(void 0!==a.submissionPixels.top&&a.submissionPixels.top&&e("body").prepend(a.submissionPixels.top),void 0!==a.submissionPixels.bottom&&a.submissionPixels.bottom&&e("body").append(a.submissionPixels.bottom),void 0!==a.submissionPixels.head&&a.submissionPixels.head&&e("head").append(a.submissionPixels.head)),void 0!==a.declinePixels&&(void 0!==a.declinePixels.top&&a.declinePixels.top&&e("body").prepend(a.declinePixels.top),void 0!==a.declinePixels.bottom&&a.declinePixels.bottom&&e("body").append(a.declinePixels.bottom),void 0!==a.declinePixels.head&&a.declinePixels.head&&e("head").append(a.declinePixels.head))}function f(a,r){window.onbeforeunload=null;var i,n=!!r.onlyRedirect&&r.onlyRedirect;if(app_config.cbtoken.length&&!n){var o=e("<form />").attr({id:"redirect-to",method:"POST",action:a}),s=e("<input />").attr({name:"cbtoken",value:app_config.cbtoken});o.append(s),o.appendTo("body"),o.submit()}else-1!=(i=navigator.userAgent.toLowerCase()).indexOf("msie")&&parseInt(i.split("msie")[1])?window.location.replace(a):(void 0===r.skipQueryParams&&history.pushState({},null,r.redirect),window.location.assign(a))}function u(){e.ajax({url:app_config.offer_path+AJAX_PATH+"refresh-csrf-token",method:"post",success:function(a){e("[name='csrf_token']").val(a.data)}})}return{formElementSelectors:{firstName:"[name=firstName], [name$=FirstName]",lastName:"[name=lastName], [name$=LastName]",address1:"[name=address1], [name$=Address1]",address2:"[name=address2], [name$=Address2]",country:"[name=country], [name$=Country]",state:"[name=state], [name$=State]",city:"[name=city], [name$=City]",zip:"[name=zip], [name$=Zip]",email:"[name=email], [name$=Email]",phone:"[name=phone], [name$=Phone]",cardNumber:"[name=cardNumber], [name$=CardNumber]",cardType:"[name=cardType], [name$=CardType]",cardExpiryMonth:"[name=cardExpiryMonth], [name=expmonth]",cardExpiryYear:"[name=cardExpiryYear], [name=expyear]",cvv:"[name=cvv], [name=CVV]"},formActions:n,validateForm:function(a,i){var n=function(a,r){a.find("input, select").each((function(){e(this).removeClass("cb-loaded-field")}));var i={};switch(r){case"prospect":i=e.extend(!0,{},t);break;case"checkout":i=e.extend(!0,{},d);break;case"downsell":i=e.extend(!0,{},l);break;default:i={fields:{},data:{},errors:{}}}for(var n in i.fields){if(i.fields[n].hasOwnProperty("condition")){var o=i.fields[n].condition;if(i.data.hasOwnProperty(o[0])||m(o[0],i,a),i.data[o[0]].value.toLowerCase()!==o[1])continue}i.data.hasOwnProperty(n)||m(n,i,a),i.data[n].hasOwnProperty("name")&&a.find('[name="'+i.data[n].name+'"]').addClass("cb-loaded-field")}return a.find("input, select").not("[type=hidden], [type=submit]").each((function(){!e(this).hasClass("cb-loaded-field")&&e(this).attr("name")&&(i.fields[e(this).attr("name")]={},i.data[e(this).attr("name")]={value:e(this).val(),name:e(this).attr("name")})})),a.find("input, select").each((function(){e(this).removeClass("cb-loaded-field")})),i}(a,i);for(var o in n.data){var s=n.data[o].name;if(0!==a.find('[name="'+s+'"]').length){var v=a.find('[name="'+s+'"]');if(v.hasClass("required"))if(v.data("ignore")&&v.has(r))n.errors[s]=v.data("error-message"),void 0===n.errors[s]&&(n.errors[s]="Enter a valid "+s.toUpperCase());else if(p(o,n,v),!n.errors.hasOwnProperty(o)&&n.fields[o].hasOwnProperty("validators"))for(var f in n.fields[o].validators){var u=JSON.stringify(n.fields[o].validators[f]);c(o,JSON.parse(u),n,v)}}}return JSON.parse(JSON.stringify(n.errors))},submitForm:function(i,o){for(var s=0,t=cb.currentFormSubmitEvents.length;s<t;s++){var d=cb.currentFormSubmitEvents[s];return cb.currentFormSubmitEvents.splice(s,1),void d(i,o)}var l=n[o.type];e("input[name=altered_action]").length&&(l=e("input[name=altered_action]").val());var c=location.search.match("test_flag")?"&test_flag=on":"",p=app_config.cbtoken.length?"&cbtoken="+app_config.cbtoken:"";e.ajax({url:app_config.offer_path+AJAX_PATH+l,method:"post",data:i.serialize()+c+p,beforeSend:function(){e(o.ajaxLoader.div).fadeIn(o.ajaxLoader.timeInOut)},success:function(n){"object"!=typeof n&&(n=JSON.parse(n)),function(i,n,o){if(i.success&&"is_html"in i&&1==i.is_html)return window.onbeforeunload=null,void function(e){var a=document.open("text/html","replace");a.write(e),a.close()}(i.html);if(!0===i.success)app_config.enable_csrf_token&&u(),"function"==typeof o.onSuccess?o.onSuccess(i):(f(i.redirect,i),cb.ignoreExitPop=!0);else if(i.hasOwnProperty("prepaidRedirect"))f(i.prepaidRedirect,i);else if(i.hasOwnProperty("Redirect"))f(i.Redirect,i);else if(i.hasOwnProperty("errors")){if(v(i),"function"==typeof o.onError)o.onError(i);else try{if(e(o.responseLoader.div).length){var s="";e.each(i.errors,(function(e,a){s+="<li>"+a+"</li>"}));var t="<ul>"+s+"</ul></div>";e(o.responseLoader.div).html(t).fadeIn(o.responseLoader.timeInOut)}else!function(i){if(i.is_form_element&&i.form_element_name){var n=e("[name="+i.form_element_name+"]");n.length&&n.addClass(r).removeClass(a)}}(i),cb.errorHandler(i.errors)}catch(e){cb.errorHandler([app_lang.error_messages.common_error])}e(o.ajaxLoader.div).length?e(o.ajaxLoader.div).fadeOut(o.ajaxLoader.timeInOut):e("body").find("#loaderImage").remove(),n.find("[type=submit]").removeAttr("disabled")}}(n,i,o)},complete:function(){}})},validClass:a,errorClass:r,loadingClass:i,ignoreExitPop:!0,errorHandler:function(a,r){if(app_config.enable_csrf_token&&u(),"hide"!==app_config.show_validation_errors)if("inline"!==app_config.show_validation_errors||void 0===r)e("#error_handler_overlay").length&&e("#error_handler_overlay").remove(),e("body").append(function(a){var r="";e.each(a,(function(e,a){r+="<li>"+a+"</li>"}));var i="";return i+='<div id="error_handler_overlay">',i+='<div class="error_handler_body">',i+='<a href="javascript:void(0);" id="error_handler_overlay_close">X</a>',i+="<ul>"+r+"</ul></div>",i+="</div>"}(a)),e("#error_handler_overlay").fadeIn(0);else for(var i in e(r).find("input, select").next(".cb-inline-error").remove(),a){r.find("[name='"+i+"']").after('<span class="cb-inline-error">'+a[i]+"</span>")}},beforeFormSubmitEvents:[],currentFormSubmitEvents:[],decryptAllowedTestCard:function(e,a){for(var r=e.split(""),i=Math.floor(r.length/2),n=0,o=[],s=0;s<i;s++)n?o.push(r[s]):o.push(r[i+s]),n=1-n;return JSON.parse(o.join(""))},urlErrorHandler:function(){for(var e=window.location.search.replace("?","").split("&"),a=0,r=e.length;a<r;a++)e[a].match(/^error=/)&&cb.errorHandler({urlError:e[a].replace("error=","").replace(/\+/g," ")})},renderAdditionalPixels:v}}(jQuery);